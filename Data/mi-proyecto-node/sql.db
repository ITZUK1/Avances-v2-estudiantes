//Creación de la base de datos //


CREATE DATABASE ColegioDB;
USE ColegioDB;

-- Creación de la tabla Profesor
CREATE TABLE Profesor (
    id INT AUTO_INCREMENT PRIMARY KEY,
    documento_identidad VARCHAR(20) NOT NULL,
    nombre VARCHAR(100) NOT NULL,
    fecha_nacimiento DATE,
    telefono VARCHAR(15),
    status ENUM('activo', 'inactivo') DEFAULT 'activo'
);

-- Creación de la tabla Curso
CREATE TABLE Curso (
    id INT AUTO_INCREMENT PRIMARY KEY,
    descripcion VARCHAR(255) NOT NULL
);

-- Creación de la tabla Estudiante
CREATE TABLE Estudiante (
    id INT AUTO_INCREMENT PRIMARY KEY,
    documento_identidad VARCHAR(20) NOT NULL,
    nombre VARCHAR(100) NOT NULL,
    fecha_nacimiento DATE,
    telefono VARCHAR(15),
    status ENUM('activo', 'inactivo') DEFAULT 'activo',
    curso_id INT,  -- Relación con Curso
    FOREIGN KEY (curso_id) REFERENCES Curso(id) ON DELETE SET NULL
);

-- Creación de la tabla Materia
CREATE TABLE Materia (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    descripcion TEXT,
    semestre VARCHAR(10),
    fecha_inicio DATE,
    status ENUM('activo', 'inactivo') DEFAULT 'activo',
    profesor_id INT,  -- Relación con Profesor
    curso_id INT,  -- Relación con Curso
    FOREIGN KEY (profesor_id) REFERENCES Profesor(id) ON DELETE SET NULL,
    FOREIGN KEY (curso_id) REFERENCES Curso(id) ON DELETE SET NULL);
    
    -- Creación de la tabla Inasistencia
CREATE TABLE Inasistencia (
    id INT AUTO_INCREMENT PRIMARY KEY,
    fecha DATE NOT NULL,  -- Fecha de la inasistencia
    estudiante_id INT NOT NULL,  -- Relación con Estudiante
    materia_id INT NOT NULL,  -- Relación con Materia
    motivo TEXT,  -- Opcional: Descripción del motivo de la inasistencia
    FOREIGN KEY (estudiante_id) REFERENCES Estudiante(id) ON DELETE CASCADE,
    FOREIGN KEY (materia_id) REFERENCES Materia(id) ON DELETE CASCADE
);

-- Asegurarse de que el nombre del estudiante sea único
ALTER TABLE Estudiante ADD UNIQUE (nombre);

-- Asegurarse de que el nombre de la materia sea único
ALTER TABLE Materia ADD UNIQUE (nombre);

ALTER TABLE Estudiante ADD avatar_url VARCHAR(255);

